<!DOCTYPE html>
<html lang="ja">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>重願可否診断ページ</title>

 <style>
	.co-app-diagnosis__form {
			margin-bottom: 30px;
	}
	.co-app-diagnosis__form .submit-btn {
		margin-block: 30px;
		/* 可愛いボタンデザイン */
		background: linear-gradient(to right, #FF9A9E, #FECFEF);
		color: #fff;
		border: none;
		border-radius: 25px;
		padding: 12px 30px;
		font-size: 16px;
		font-weight: bold;
		cursor: pointer;
		box-shadow: 0 4px 15px rgba(255, 154, 158, 0.5);
		transition: all 0.3s ease;
		position: relative;
		overflow: hidden;
	}
	.co-app-diagnosis__form .submit-btn:hover:not(:disabled) {
		transform: translateY(-3px);
		box-shadow: 0 6px 20px rgba(255, 154, 158, 0.6);
	}
	.co-app-diagnosis__form .submit-btn:active:not(:disabled) {
		transform: translateY(1px);
		box-shadow: 0 2px 10px rgba(255, 154, 158, 0.4);
	}
	.co-app-diagnosis__form .submit-btn::before {
		content: "";
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.3), transparent);
		transition: left 0.7s ease;
	}
	.co-app-diagnosis__form .submit-btn:hover:not(:disabled)::before {
		left: 100%;
	}
	/* 非活性状態のスタイル */
	.co-app-diagnosis__form .submit-btn:disabled {
		background: linear-gradient(to right, #cccccc, #dddddd);
		cursor: not-allowed;
		box-shadow: none;
		opacity: 0.7;
	}
	.co-app-diagnosis__form fieldset + fieldset {
		margin-top: 30px;
	}
	.answer {
		display: none;
		border-radius: 10px;
		padding: 15px;
		margin-top: 20px;
		background-color: #f8f8f8;
		box-shadow: 0 2px 8px rgba(0,0,0,0.1);
	}
	.answer p {
		margin: 0;
		font-size: 16px;
	}
	.answer span {
		display: inline-block;
		margin-right: 10px;
		padding: 3px 8px;
		background-color: #ffaab3;
		color: white;
		border-radius: 4px;
		font-weight: bold;
		font-size: 14px;
	}
 </style>
 <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
 <!-- data.jsを先に読み込み -->
 <script src="/js/data.js"></script>
</head>
<body>
 <section id="app" class="co-app-diagnosis">
  <div class="l-inner">
   <!-- 診断 -->
		<form @submit.prevent="diagnose" class="co-app-diagnosis__form" id="diagnosisForm">
			<!-- 階級 -->
			<fieldset>
				<legend>受験級を選択してください。</legend>
				<div>
					<input type="radio" id="g2-3" name="grade" value="2～3級" v-model="grade" />
					<label for="g2-3">2~3級</label>
				</div>
				<div>
					<input type="radio" id="g4-5" name="grade" value="4・5級" v-model="grade" />
					<label for="g4-5">4・5級</label>
				</div>
			</fieldset>
			<!-- 年齢 -->
			<fieldset>
				<legend>年齢を選択してください。</legend>
				<div>
					<input type="radio" id="under20" name="age" value="20歳以下" v-model="age" />
					<label for="under20">20歳以下(2004年4月2日以降生まれ)</label>
				</div>
				<div>
					<input type="radio" id="over20" name="age" value="20歳以上" v-model="age" />
					<label for="over20">20歳以上(2004年4月1日以前生まれ)</label>
				</div>
			</fieldset>
			<p>1つ目の受験について</p>
			<hr>
			<fieldset>
				<legend>（１）受験方法を選択してください</legend>
				<div>
					<input type="radio" id="firstApplication-type1" name="firstApplication-type" value="団体" v-model="firstApp.type" />
					<label for="firstApplication-type1">団体受験 : 学校や塾で申し込み</label>
				</div>
				<div>
					<input type="radio" id="firstApplication-type2" name="firstApplication-type" value="個人" v-model="firstApp.type" />
					<label for="firstApplication-type2">個人受験 : 個人でインターネットやコンビニで申し込み</label>
				</div>
			</fieldset>
			<!-- 団体受験を選択した場合のみ表示 -->
			<fieldset v-if="firstApp.type === '団体'">
				<legend>（２）団体の区分を選択してください</legend>
				<div>
					<input type="radio" id="firstApplication-organizationType1" name="firstApplication-organizationType" value="学校" v-model="firstApp.organizationType" />
					<label for="firstApplication-organizationType1">学校など <br>小学校、中学校、高等学校、大学、短大、専修学校、各種学校、官公庁公営企業体、企業</label>
				</div>
				<div>
					<input type="radio" id="firstApplication-organizationType2" name="firstApplication-organizationType" value="塾" v-model="firstApp.organizationType" />
					<label for="firstApplication-organizationType2">学習塾、予備校</label>
				</div>
			</fieldset>
			<!-- 団体受験を選択した場合のみ表示 -->
			<fieldset v-if="firstApp.type === '団体'">
				<legend>（３）受験方法の区分を選択してください</legend>
				<div>
					<input type="radio" id="firstApplication-preference1" name="firstApplication-preference" value="本" v-model="firstApp.preference" />
					<label for="firstApplication-preference1">本会場 : F日程、本会場日程</label>
				</div>
				<div>
					<input type="radio" id="firstApplication-preference2" name="firstApplication-preference" value="準" v-model="firstApp.preference" />
					<label for="firstApplication-preference2">準会場 : A~E日程</label>
				</div>
			</fieldset>
			<p>2つ目の受験について</p>
			<hr>
			<fieldset>
				<legend>（１）受験方法を選択してください</legend>
				<div>
					<input type="radio" id="secondApplication-type1" name="secondApplication-type" value="団体" v-model="secondApp.type" />
					<label for="secondApplication-type1">団体受験 : 学校や塾で申し込み</label>
				</div>
				<div>
					<input type="radio" id="secondApplication-type2" name="secondApplication-type" value="個人" v-model="secondApp.type" />
					<label for="secondApplication-type2">個人受験 : 個人でインターネットやコンビニで申し込み</label>
				</div>
			</fieldset>
			<!-- 団体受験を選択した場合のみ表示 -->
			<fieldset v-if="secondApp.type === '団体'">
				<legend>（２）団体の区分を選択してください</legend>
				<div>
					<input type="radio" id="secondApplication-organizationType1" name="secondApplication-organizationType" value="学校" v-model="secondApp.organizationType" />
					<label for="secondApplication-organizationType1">学校など <br>小学校、中学校、高等学校、大学、短大、専修学校、各種学校、官公庁公営企業体、企業</label>
				</div>
				<div>
					<input type="radio" id="secondApplication-organizationType2" name="secondApplication-organizationType" value="塾" v-model="secondApp.organizationType" />
					<label for="secondApplication-organizationType2">学習塾、予備校</label>
				</div>
			</fieldset>
			<!-- 団体受験を選択した場合のみ表示 -->
			<fieldset v-if="secondApp.type === '団体'">
				<legend>（３）受験方法の区分を選択してください</legend>
				<div>
					<input type="radio" id="secondApplication-preference1" name="secondApplication-preference" value="本" v-model="secondApp.preference" />
					<label for="secondApplication-preference1">本会場 : F日程、本会場日程</label>
				</div>
				<div>
					<input type="radio" id="secondApplication-preference2" name="secondApplication-preference" value="準" v-model="secondApp.preference" />
					<label for="secondApplication-preference2">準会場 : A~E日程</label>
				</div>
			</fieldset>

			<button type="submit" class="submit-btn" :disabled="!isFormValid">
				診断する
			</button>

		</form>
    <!-- 診断結果 -->
    <div class="co-app-diagnosis__result">
			<!-- OK -->
			<div class="answer" v-show="diagnosisResult === 'ok'">
				<p>併願が可能です。</p>
			</div>
			<!-- NG01 -->
			<div class="answer" v-show="diagnosisResult === 'ng01'">
				<p>
					<span>本-本かぶり</span>
					本命校同士の併願はできません。
				</p>
			</div>
			<!-- NG02 -->
			<div class="answer" v-show="diagnosisResult === 'ng02'">
				<p>
					<span>準-準かぶり</span>
					準備校同士の併願はできません。
				</p>
			</div>
			<!-- NG03 -->
			<div class="answer" v-show="diagnosisResult === 'ng03'">
				<p>
					<span>二次日程かぶり（A）</span>
					二次試験の日程が重複しています（Aパターン）。
				</p>
			</div>
			<!-- NG04 -->
			<div class="answer" v-show="diagnosisResult === 'ng04'">
				<p>
					<span>二次日程かぶり（B）</span>
					二次試験の日程が重複しています（Bパターン）。
				</p>
			</div>
		</div>
  </div>
 </section>
 <script>
  const { createApp, ref, watch, computed } = Vue;
  
  createApp({
    setup() {
      // 外部から読み込んだdiagnosisJsonDataをrefに代入
      const diagnosisData = ref(diagnosisJsonData);
      console.log('診断データをロードしました:', diagnosisData.value);
      
      // フォームデータ
      const grade = ref('');
      const age = ref('');
      const firstApp = ref({
        type: '',
        organizationType: '',
        preference: ''
      });
      const secondApp = ref({
        type: '',
        organizationType: '',
        preference: ''
      });
      
      // 診断結果の状態
      const diagnosisResult = ref('');
      
      // 選択タイプが変わったときに関連データをリセット
      watch(() => firstApp.value.type, (newType) => {
        if (newType !== '団体') {
          // 団体受験から個人受験に変更された場合、団体関連データをリセット
          firstApp.value.organizationType = '';
          firstApp.value.preference = '';
        }
      });
      
      watch(() => secondApp.value.type, (newType) => {
        if (newType !== '団体') {
          // 団体受験から個人受験に変更された場合、団体関連データをリセット
          secondApp.value.organizationType = '';
          secondApp.value.preference = '';
        }
      });
      
      // フォームの入力チェック
      const isFormValid = computed(() => {
        // 基本情報のチェック
        if (!grade.value || !age.value) {
          return false;
        }
        
        // 1つ目の受験
        if (!firstApp.value.type) {
          return false;
        }
        
        // 団体受験の場合は団体区分と受験方法区分も必須
        if (firstApp.value.type === '団体') {
          if (!firstApp.value.organizationType || !firstApp.value.preference) {
            return false;
          }
        }
        
        // 2つ目の受験
        if (!secondApp.value.type) {
          return false;
        }
        
        // 団体受験の場合は団体区分と受験方法区分も必須
        if (secondApp.value.type === '団体') {
          if (!secondApp.value.organizationType || !secondApp.value.preference) {
            return false;
          }
        }
        
        // すべての条件を満たしている場合
        return true;
      });
      
      // 年齢のフォーマット変換（APIに合わせる）
      const formatAge = (ageValue) => {
        if (ageValue === '20歳以下') {
          return '20才以下';
        } else {
          return '21才以上';
        }
      };
      
      // 診断ロジック - JSONデータと照合
      const diagnose = () => {
        console.log('診断を実行します...');
        
        // 検索条件の作成
        const searchCondition = {
          grade: grade.value,
          ageGroup: formatAge(age.value),
          firstApplication: {
            type: firstApp.value.type
          },
          secondApplication: {
            type: secondApp.value.type
          }
        };
        
        // 団体受験の場合の追加情報
        if (firstApp.value.type === '団体') {
          searchCondition.firstApplication.organizationType = firstApp.value.organizationType;
          searchCondition.firstApplication.preference = firstApp.value.preference;
        } else if (firstApp.value.type === '個人') {
          // 個人受験の場合も preference が必要（メインコードではハードコードしていたが、JSONによる判定ではそれぞれのケースで異なる可能性がある）
          searchCondition.firstApplication.preference = '本'; // 個人受験は「本」のみを想定
        }
        
        if (secondApp.value.type === '団体') {
          searchCondition.secondApplication.organizationType = secondApp.value.organizationType;
          searchCondition.secondApplication.preference = secondApp.value.preference;
        } else if (secondApp.value.type === '個人') {
          searchCondition.secondApplication.preference = '本'; // 個人受験は「本」のみを想定
        }
        
        console.log('検索条件:', searchCondition);
        
        // JSONデータと照合
        const result = findDiagnosisResult(searchCondition);
        
        if (result) {
          console.log('診断結果:', result);
          
          if (result.result === 'OK') {
            diagnosisResult.value = 'ok';
          } else if (result.result === 'NG') {
            // NGの理由IDから対応する診断結果を設定
            if (result.reasonId === 1) {
              diagnosisResult.value = 'ng01';
            } else if (result.reasonId === 2) {
              diagnosisResult.value = 'ng02';
            } else if (result.reasonId === 3) {
              diagnosisResult.value = 'ng03';
            } else if (result.reasonId === 4) {
              diagnosisResult.value = 'ng04';
            }
          }
        } else {
          console.log('該当する診断結果が見つかりませんでした');
          alert('該当する診断ケースが見つかりませんでした。入力内容をご確認ください。');
        }
      };
      
      // 条件に合致する診断結果を検索
      const findDiagnosisResult = (condition) => {
        if (!diagnosisData.value || !diagnosisData.value.diagnosisResults) {
          return null;
        }
        
        return diagnosisData.value.diagnosisResults.find(item => {
          // 基本条件のチェック
          if (item.grade !== condition.grade || item.ageGroup !== condition.ageGroup) {
            return false;
          }
          
          // 1つ目の受験条件チェック
          const first = item.firstApplication;
          const firstCondition = condition.firstApplication;
          if (first.type !== firstCondition.type || first.preference !== firstCondition.preference) {
            return false;
          }
          
          // 団体受験の場合の追加チェック
          if (first.type === '団体' && first.organizationType !== firstCondition.organizationType) {
            return false;
          }
          
          // 2つ目の受験条件チェック
          const second = item.secondApplication;
          const secondCondition = condition.secondApplication;
          if (second.type !== secondCondition.type || second.preference !== secondCondition.preference) {
            return false;
          }
          
          // 団体受験の場合の追加チェック
          if (second.type === '団体' && second.organizationType !== secondCondition.organizationType) {
            return false;
          }
          
          // すべての条件に一致
          return true;
        });
      };

      return {
        grade,
        age,
        firstApp,
        secondApp,
        diagnosisResult,
        diagnose,
        isFormValid
      };
    }
  }).mount("#app");
 </script>
</body>
</html>